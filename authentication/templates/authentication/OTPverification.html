{% load static%}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

		<title>
            SA Express | Sign in
        </title>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

		<!-- Bootstrap -->
		<link type="text/css" rel="stylesheet" href="{% static 'css/bootstrap.min.css'  %}"/>

		<!-- Slick -->
		<link type="text/css" rel="stylesheet" href="{% static 'css/slick.css'  %}"/>
		<link type="text/css" rel="stylesheet" href="{% static 'css/slick-theme.css'  %}"/>

		<!-- nouislider -->
		<link type="text/css" rel="stylesheet" href="{% static 'css/nouislider.min.css '  %}"/>

		<!-- Font Awesome Icon -->
		<link rel="stylesheet" href="{% static 'css/font-awesome.min.css'  %}">

		<!-- Custom stlylesheet -->
		<link type="text/css" rel="stylesheet" href="{% static 'css/style.css' %}"/>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

       
		<style>
            .input-group {
                position: relative;
                width: 100%;
            }
            .input-icon {
                position: absolute;
                left: 10px;
                top: 10px;
                color: #999;
                z-index: 10;
            }
            .password-toggle {
                position: absolute;
                right: 10px;
                top: 10px;
                color: #999;
                cursor: pointer;
                z-index: 10;
            }
            .has-icon {
                padding-left: 40px;
            }
            
            /* Timer styles */
            #timer {
                margin-top: 10px;
                font-weight: bold;
                color: #D10024;
            }
            
            .timer-container {
                text-align: center;
                margin-bottom: 15px;
            }
        </style>
		<!-- Add this inside the <style> block -->
<style>
    .spinner {
        position: relative;
        width: 6.4px;
        height: 6.4px;
        margin: 0 auto; /* Center the spinner */
    }

    .spinner div {
        position: absolute;
        width: 50%;
        height: 150%;
        background: #d10024;
        transform: rotate(calc(var(--rotation) * 1deg)) translate(0, calc(var(--translation) * 1%));
        animation: spinner-fzua35 1s calc(var(--delay) * 1s) infinite ease;
    }

    .spinner div:nth-child(1) {
        --delay: 0.1;
        --rotation: 36;
        --translation: 150;
    }

    .spinner div:nth-child(2) {
        --delay: 0.2;
        --rotation: 72;
        --translation: 150;
    }

    .spinner div:nth-child(3) {
        --delay: 0.3;
        --rotation: 108;
        --translation: 150;
    }

    .spinner div:nth-child(4) {
        --delay: 0.4;
        --rotation: 144;
        --translation: 150;
    }

    .spinner div:nth-child(5) {
        --delay: 0.5;
        --rotation: 180;
        --translation: 150;
    }

    .spinner div:nth-child(6) {
        --delay: 0.6;
        --rotation: 216;
        --translation: 150;
    }

    .spinner div:nth-child(7) {
        --delay: 0.7;
        --rotation: 252;
        --translation: 150;
    }

    .spinner div:nth-child(8) {
        --delay: 0.8;
        --rotation: 288;
        --translation: 150;
    }

    .spinner div:nth-child(9) {
        --delay: 0.9;
        --rotation: 324;
        --translation: 150;
    }

    .spinner div:nth-child(10) {
        --delay: 1;
        --rotation: 360;
        --translation: 150;
    }

    @keyframes spinner-fzua35 {
        0%, 10%, 20%, 30%, 50%, 60%, 70%, 80%, 90%, 100% {
            transform: rotate(calc(var(--rotation) * 1deg)) translate(0, calc(var(--translation) * 1%));
        }

        50% {
            transform: rotate(calc(var(--rotation) * 1deg)) translate(0, calc(var(--translation) * 1.5%));
        }
    }
</style>
    </head>
	<body>
		<!-- HEADER -->
		<header>
			<!-- TOP HEADER -->
			<div id="top-header">
				<div class="container">
					<ul class="header-links pull-left">
						<li><a href="#"><i class="fa fa-phone"></i> +233552180200</a></li>
						<li><a href="#"><i class="fa fa-envelope-o"></i> email@email.com</a></li>
						<li><a href="#"><i class="fa fa-map-marker"></i> 1734 Ghana Road</a></li>
					</ul>
					<ul class="header-links pull-right">
						<li><a href="#"><i class="fa fa-dollar"></i> GHS</a></li>
						<li><a><i class="fa fa-user-plus"></i> Register</a></li>
					</ul>
				</div>
			</div>
			<!-- /TOP HEADER -->

			<!-- MAIN HEADER -->
			<div id="header">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<!-- LOGO -->
						<div class="col-md-3">
							<div class="header-logo">
								<a href="{% url 'main:index'%}" class="logo">
									<h2 style="color: white;">
										<span style="color: #D10024;">
											SA
										</span>
										
										 Express</h2>
								</a>
							</div>
						</div>
						<!-- /LOGO -->
					</div>
					<!-- row -->
				</div>
				<!-- container -->
			</div>
			<!-- /MAIN HEADER -->
		</header>
		<!-- /HEADER -->
		
		<!-- SECTION -->
		
		<div class="section" style="margin-top:20px;margin-bottom: 20px;">
			<!-- container -->
            <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
					<div id="alert-container"></div>

					{% if messages %}
					<div class="messages">
						{% for message in messages %}
							<div class="alert {% if message.tags == 'success' %}alert-green{% elif message.tags == 'error' %}alert-red{% endif %}" role="alert">
								{{ message }}
								<button type="button" class="close-btn" aria-label="Close">
									<span class="sr-only">Close</span>
									<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
										<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
									</svg>
								</button>
							</div>
						{% endfor %}
					</div>
				{% endif %}

					<div class="billing-details">

					<div class="section-title text-center">
						<h3 class="title">Verify Code</h3>
					</div>
						<form method="post" action="{% url 'auth:verify_otp' user_id %}">
							{% csrf_token %}
							
							<div class="form-group">
								<div class="input-group">
									<i class="fa fa-key input-icon"></i>
									<input class="input has-icon" type="text" name="otp" placeholder="Code" required>
								</div>
							</div>
							
							<div class="form-group text-center">
								<button type="submit" class="primary-btn">Verify</button>
							</div>
							
						
							<div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 40px;">
								<hr style="flex-grow: 1; border: none; border-top: 1px solid #ccc; height: 1px;">
								<div>
									<p id="resend-text" style="display: none;">
										Didn't receive an OTP? 
										<a href="#" id="resend-link" class="disabled" style="pointer-events: none; color: #999;">
											Resend OTP
										</a>
									</p>
									<div class="timer-container">
										<div id="timer">01:00</div>
									</div>
									<!-- Spinner container -->
									<div id="spinner-container" style="display: none;"></div>
								</div>
								<hr style="flex-grow: 1; border: none; border-top: 1px solid #ccc; height: 1px;">
							</div>
						</form>
						</div>
                    </div>
                </div>
            </div>
        </div>
			<!-- /container -->
		</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->

		<!-- FOOTER -->
		<footer id="footer">
			<!-- top footer -->
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">About Us</h3>
								<p>SA Express</p>
								<ul class="footer-links">
									<li><a href="#"><i class="fa fa-map-marker"></i>1734 Ghana Road</a></li>
									<li><a href="#"><i class="fa fa-phone"></i>+233552180200</a></li>
									<li><a href="#"><i class="fa fa-envelope-o"></i>email@email.com</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Categories</h3>
								<ul class="footer-links">
									<li><a href="#">Hot deals</a></li>
									<li><a href="#">Laptops</a></li>
									<li><a href="#">Smartphones</a></li>
									<li><a href="#">Cameras</a></li>
									<li><a href="#">Accessories</a></li>
								</ul>
							</div>
						</div>

						<div class="clearfix visible-xs"></div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Information</h3>
								<ul class="footer-links">
									<li><a href="#">About Us</a></li>
									<li><a href="#">Contact Us</a></li>
									<li><a href="#">Privacy Policy</a></li>
									<li><a href="#">Terms & Conditions</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Service</h3>
								<ul class="footer-links">
									
									<li><a href="#">Help</a></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /top footer -->

			<!-- bottom footer -->
			<div id="bottom-footer" class="section">
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-12 text-center">
							<ul class="footer-payments">
								<li><a href="#"><i class="fa fa-cc-visa"></i></a></li>
								<li><a href="#"><i class="fa fa-credit-card"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-paypal"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-mastercard"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-discover"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-amex"></i></a></li>
							</ul>
							<span class="copyright">
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | SA Express</a>
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</span>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /bottom footer -->
		</footer>
		<!-- /FOOTER -->

		<!-- jQuery Plugins -->
		<script src="{% static 'js/jquery.min.js' %}"></script>
		<script src="{% static 'js/bootstrap.min.js' %}"></script>
		
	
<script>

$(document).ready(function() {
    // Close Django message alerts when the close button is clicked
    document.querySelectorAll('.messages .close-btn').forEach(function(button) {
        button.addEventListener('click', function() {
            const alert = this.closest('.alert');
            if (alert) {
                alert.remove();
            }
        });
    });

    let duration = 1 * 60; // 1 minute in seconds
    const timerDisplay = document.getElementById('timer');
    const resendText = document.getElementById('resend-text');
    const resendLink = document.getElementById('resend-link');
    const spinnerContainer = document.getElementById('spinner-container');
    const timerContainer = document.querySelector('.timer-container');
    let timer;

    // Function to start the timer
    function startTimer() {
        console.log("Starting timer..."); // Debugging
        clearInterval(timer); // Clear any existing timer
        duration = 1 * 60; // Reset duration to 1 minute

        // Hide the resend text and show the timer
        resendText.style.display = 'none';
        timerContainer.style.display = 'block';

        // Store the end time in localStorage
        const endTime = Math.floor(Date.now() / 1000) + duration;
        localStorage.setItem('otpTimerEnd', endTime);

        // Start the countdown
        timer = setInterval(function() {
            duration--;
            
            // Update the timer display
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            timerDisplay.textContent = 
                (minutes < 10 ? '0' + minutes : minutes) + ':' + 
                (seconds < 10 ? '0' + seconds : seconds);
            
            // Check if timer has expired
            if (duration <= 0) {
                clearInterval(timer);
                enableResend();
            }
        }, 1000);
    }

    // Function to enable the resend link
    function enableResend() {
        console.log("Enabling resend link..."); // Debugging
        resendText.style.display = 'block';
        timerContainer.style.display = 'none';
        resendLink.style.pointerEvents = 'auto';
        resendLink.style.color = '#D10024';
        resendLink.classList.remove('disabled');
        localStorage.removeItem('otpTimerEnd');
    }

    // Check if there's a stored timer end time
    const storedEndTime = localStorage.getItem('otpTimerEnd');
    if (storedEndTime && !isNaN(storedEndTime)) {
        const now = Math.floor(Date.now() / 1000);
        const remaining = storedEndTime - now;
        if (remaining > 0) {
            duration = remaining;
            startTimer();
        } else {
            enableResend();
        }
    } else {
        startTimer();
    }

    // Handle resend link click
    resendLink.addEventListener('click', function(e) {
        e.preventDefault();

        if (!resendLink.classList.contains('disabled')) {
            // Disable the link temporarily to prevent multiple clicks
            resendLink.classList.add('disabled');
            resendLink.style.pointerEvents = 'none';

            // Show the spinner
            spinnerContainer.style.display = 'block';
            spinnerContainer.innerHTML = `
                <div class="spinner">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            `;

            // Send AJAX request to resend OTP
            fetch(`/auth/resend-otp/{{user_id}}/`, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                },
            })
            .then(response => response.json())
            .then(data => {
                console.log("AJAX Response:", data); // Debugging
                if (data.status === 'success') {
                    // Reset the timer
                    startTimer();

                    // Display the success alert
                    showAlert(data.message, 'success');
                } else {
                    // Display the error alert
                    showAlert(data.message || 'Something went wrong. Please try again.', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Failed to resend OTP. Please try again.', 'error');
            })
            .finally(() => {
                // Hide the spinner
                spinnerContainer.style.display = 'none';
                spinnerContainer.innerHTML = '';

                // Re-enable the resend link
                resendLink.classList.remove('disabled');
                resendLink.style.pointerEvents = 'auto';
            });
        }
    });

    // Function to show the alert
    function showAlert(message, type = 'success') {
        const alertClass = type === 'success' ? 'alert-green' : 'alert-red';
        const alertHTML = `
            <div class="alert ${alertClass} custom-alert" role="alert">
                <svg style="height:30px;width:30px" class="shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                </svg>
                <span class="sr-only">Info</span>
                <div style="margin-left:5px" class="ms-3 font-medium">
                    ${message}
                </div>
                <button type="button" class="close-btn" aria-label="Close">
                    <span class="sr-only">Close</span>
                    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                </button>
            </div>
        `;

        // Insert the alert into the alert container
        const alertContainer = document.getElementById('alert-container');
        const alertDiv = document.createElement('div');
        alertDiv.innerHTML = alertHTML;
        alertContainer.appendChild(alertDiv);

        // Add event listener to the close button
        const closeBtn = alertDiv.querySelector('.close-btn');
        closeBtn.addEventListener('click', function() {
            alertDiv.remove();
        });

        // Automatically remove the alert after 5 seconds
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }
});
	</script>
			<script src="{% static 'js/main.js' %}"></script>

	</body>
</html>